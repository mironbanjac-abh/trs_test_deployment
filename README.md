# ARIMA-Based Final Exam Pass Probability API

This deployment provides a REST API for predicting the probability of passing a final exam using ARIMA (AutoRegressive Integrated Moving Average) models. The API analyzes a sequence of student performance scores from exam simulations and calculates the probability of achieving a passing score (‚â•0.9) on the final exam using confidence interval analysis.

## üìã Table of Contents

- [Installation](#-installation)
- [Quick Start](#-quick-start)
- [API Documentation](#-api-documentation)
- [Output Metrics Explained](#-output-metrics-explained)
- [Confidence Interval Methods](#-confidence-interval-methods)
- [Docker Deployment](#-docker-deployment)
- [Testing](#-testing)
- [Error Handling](#-error-handling)
- [Configuration](#-configuration)
- [Performance Considerations](#-performance-considerations)
- [Next Steps and Suggested Improvements](#-next-steps-and-suggested-improvements)

## üöÄ Installation

### Prerequisites
- Python 3.11+
- pip package manager

### Local Installation

1. **Clone or navigate to the deployment directory:**

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Run the API:**
   ```bash
   uvicorn app:app --host 0.0.0.0 --port 8000
   ```

The API will be available at `http://localhost:8000`

## üèÅ Quick Start

### Starting the Server
```bash
uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

### Making a Prediction Request
```python
import requests

payload = {
    "scores": [0.9, 0.88, 0.75, 0.78, 0.74, 0.69, 0.95, 0.97, 0.73, 0.97],
    "window_size": 5,
    "ci_method": "t_distribution"
}

response = requests.post("http://localhost:8000/forecast", json=payload)
print(response.json())
```

## üìñ API Documentation

### Endpoint: `POST /forecast`

Generates ARIMA-based probability predictions for passing the final exam based on simulation scores.

#### Request Body

```json
{
    "scores": [0.9, 0.88, 0.75, 0.78, 0.74, 0.69, 0.95],
    "window_size": 5,
    "ci_method": "t_distribution"
}
```

**Parameters:**
- `scores` (List[float], required): Array of simulation score values between 0.0 and 1.0
- `window_size` (int, optional): Rolling window size for statistical calculations (default: 5)
- `ci_method` (str, optional): Method for confidence interval calculation (default: "t_distribution")
  - Options: "t_distribution", "normal_distribution", "arima_distribution"

**Validation Rules:**
- All scores must be between 0.0 and 1.0
- `window_size` must be positive and smaller than or equal to the number of scores
- Minimum number of scores required: 2
- `ci_method` must be one of the supported types

Note: While the model will run with just 2 or 3 exam simulation scores, this will result in the prediction being generated by a simple autoregressive model of order 1. Meaning it just takes into account the previous score value when making a prediction.

#### Response Format

```json
{
    "probability_of_passing_final_exam": 76.84,
    "predicted_simulation_score": 0.8429657738146251,
    "arima_best_order": [1, 0, 1],
    "confidence_interval_range": [0.7438745677895089, 0.9420569798397413]
}
```

## üìä Output Metrics Explained

### Core Prediction
- **`probability_of_passing_final_exam`**: Percentage probability (0-100%) that the student will achieve a score ‚â•0.9 on the final exam, calculated based on the confidence interval analysis
- **`predicted_simulation_score`**: The forecasted next simulation score value generated by the ARIMA model

### Model Information
- **`arima_best_order`**: The optimal ARIMA(p,d,q) parameters selected through automated model selection
  - `p`: Number of autoregressive terms
  - `d`: Degree of differencing
  - `q`: Number of moving average terms
- **`confidence_interval_range`**: The confidence interval bounds [lower_bound, upper_bound] for the prediction using the selected method

### Model Selection Logic
- **For ‚â§3 data points**: Uses AR(1) model for stability
- **For >3 data points**: Automated selection using stepwise algorithm, falling back to grid search if needed
- **Fallback order**: ARIMA(2,1,2) if automatic selection fails

## üîç Confidence Interval Methods

The API provides three different methods for calculating confidence intervals, each selected via the `ci_method` parameter. We recommend using the T-Distribution Method as this is the one used for the results shown on the presentation. Although, other methods are included to allow for customization and experimentation:

### 1. T-Distribution Method (Default)
**Parameter**: `"t_distribution"`

**Calculation Method**:
- Uses Student's t-distribution to account for small sample sizes
- Based on rolling statistics within the specified window
- Most appropriate for educational data with limited samples

**Formula**: 
```
CI = prediction ¬± t_{Œ±/2,df} √ó (rolling_std / ‚àön)
```

Where:
- `t_{Œ±/2,df}`: Critical t-value for 95% confidence level
- `df`: Degrees of freedom (window_size - 1)
- `n`: Sample size (window_size)
- `rolling_std`: Rolling standard deviation from the last window

**Use Case**: **Recommended** - Most appropriate for small sample sizes and provides accurate intervals when population standard deviation is unknown.

### 2. Normal Distribution Method
**Parameter**: `"normal_distribution"`

**Calculation Method**:
- Assumes the prediction follows a normal distribution
- Uses rolling standard deviation from the window
- Applies a 2-sigma rule (Œ± = 2) for conservative estimates

**Formula**:
```
CI = prediction ¬± 2 √ó rolling_std
```

**Use Case**: Simple and robust approach when you want conservative estimates with wider intervals.

### 3. ARIMA Distribution Method
**Parameter**: `"arima_distribution"`

**Calculation Method**:
- Uses the ARIMA model's built-in forecast confidence intervals
- Based on the model's residual variance and parameter uncertainty
- Calculated using `forecast_result.conf_int(alpha=0.05)` for 95% confidence level

**Formula**:
```
CI = prediction ¬± z_{Œ±/2} √ó ‚àö(forecast_variance)
```

**Use Case**: Most theoretically sound for ARIMA predictions as it accounts for model-specific uncertainty, but may be less reliable with small datasets.

### Pass Probability Calculation

The probability of passing the final exam is calculated based on how much of the confidence interval lies above the passing threshold (0.9):

**Formula**:
```
probability = (max(0, upper_bound - max(lower_bound, 0.9)) / (upper_bound - lower_bound)) √ó 100
```

**Interpretation**:
- **0%**: Entire confidence interval is below the passing threshold
- **100%**: Entire confidence interval is above the passing threshold  
- **50%**: Passing threshold bisects the confidence interval
- **Values between**: Proportion of the interval above the threshold

## üê≥ Docker Deployment

### Building the Docker Image
```bash
docker build -t arima-service .
```

### Running the Container
```bash
docker run -p 8000:8000 arima-service
```

### Docker Compose (Optional)
Create a `docker-compose.yml`:

```yaml
version: '3.8'
services:
  arima-api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - ENV=production
```

Run with:
```bash
docker-compose up
```

## üß™ Testing

### Using the Test Client
```bash
python test_client.py
```

### Manual Testing with cURL
```bash
curl -X POST "http://localhost:8000/forecast" \
     -H "Content-Type: application/json" \
     -d '{
       "scores": [0.9, 0.88, 0.75, 0.78, 0.74, 0.69, 0.95, 0.88, 0.9, 0.63],
       "window_size": 5,
       "ci_method": "t_distribution"
     }'
```

### API Documentation
Once the server is running, visit:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## ‚ùå Error Handling

### Common Error Responses

**400 Bad Request - Invalid Score Range:**
```json
{
    "detail": "Score at index 2 (1.5) must be between 0.0 and 1.0"
}
```

**400 Bad Request - Invalid Window Size:**
```json
{
    "detail": "window_size (10) must be smaller than or equal to the number of scores (5)"
}
```

**400 Bad Request - Non-positive Window Size:**
```json
{
    "detail": "window_size must be a positive integer"
}
```

**400 Bad Request - Invalid CI Method:**
```json
{
    "detail": "CI_distribution must be a supported type. (t_distribution or normal_distribution or arima_distribution)"
}
```

**400 Bad Request - Insufficient Data:**
```json
{
    "detail": "Probability of passing the final exam can be calculated if the student has completed at least 2 simulations."
}
```

**500 Internal Server Error - Model Fitting Issues:**
```json
{
    "detail": "ARIMA model failed to converge"
}
```

## üîß Configuration

### Environment Variables
- `HOST`: Server host (default: 0.0.0.0)
- `PORT`: Server port (default: 8000)
- `ENV`: Environment setting (development/production)

### Model Parameters
- **Default window_size**: 5
- **Default ci_method**: "t_distribution"
- **Confidence level**: 95% (Œ± = 0.05)
- **Passing threshold**: 0.9 (90% score required to pass)
- **ARIMA model selection**: Automatic using `pmdarima.auto_arima` with stepwise algorithm, grid search fallback
- **Minimum data requirement**: 2 simulation scores

## üìà Performance Considerations

- **Model Selection**: 
  - Uses AR(1) for datasets ‚â§3 points for stability
  - Uses stepwise algorithm first, falling back to grid search for larger datasets
  - Default fallback to ARIMA(2,1,2) if automatic selection fails
- **Memory Usage**: Minimal - processes one prediction at a time, no model persistence
- **Response Time**: Typically < 1 second for datasets with < 100 points
- **Scalability**: Stateless design allows for horizontal scaling
- **Data Requirements**: Works with as few as 2 simulation scores


## üöÄ Next Steps and Suggested Improvements

### Time-Aware Enhancements
- **Add timestamp support**: Include actual simulation dates instead of treating scores as equally spaced
- **Handle irregular intervals**: Account for weekends, holidays, and gaps between simulations
- **Seasonal patterns**: Detect weekly or monthly learning patterns

### Student Engagement Modeling
- **Decay factor implementation**: Apply performance degradation when students don't practice for extended periods
- **Configurable decay rates**: Different decay rates based on subject difficulty or student level
- **Inactivity thresholds**: Define minimum practice frequency to maintain performance

### Model Improvements
- **Multi-variate inputs**: Include study time, question difficulty, and topic areas
- **Ensemble methods**: Combine ARIMA with other forecasting models for better accuracy
- **Adaptive parameters**: Automatically adjust model parameters based on student behavior patterns

### API Enhancements
- **Batch processing**: Handle multiple students in a single request
- **Real-time updates**: Stream predictions as new scores arrive
- **Model persistence**: Cache fitted models to improve response times

### Educational Context
- **Learning objective tracking**: Incorporate specific skills and competencies being assessed
- **Intervention triggers**: Automatic alerts when students are predicted to fall below thresholds
- **Personalized recommendations**: Suggest study plans based on forecast confidence intervals

### Technical Improvements
- **Database integration**: Store historical predictions for accuracy tracking
- **Monitoring dashboard**: Track model performance and prediction quality over time
- **A/B testing framework**: Compare different forecasting approaches

These enhancements would make the system more realistic for educational environments where timing, student engagement, and learning progression are critical factors in performance prediction.
